generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// *
/// * Address
/// * -------
/// * Represents a physical address with detailed location information.
/// * Supports geolocation for mapping and distance calculations.
/// * Used by both users and schools for contact and location purposes.
model Address {
  id             String                @id @default(uuid())
  country        String
  state          String
  city           String
  street1        String
  street2        String?
  zip            String?
  geo            Unsupported("point")?
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
  deletedAt      DateTime?
  schoolAddress  SchoolAddress[]
  primarySchools School[]              @relation("SchoolPrimaryAddress")
  users          User[]

  @@map("addresses")
}

/// *
/// * SchoolAddress
/// * -------------
/// * Links schools to their addresses, allowing schools to have multiple locations.
/// * Each school can have multiple addresses (e.g., main campus, branch campuses).
model SchoolAddress {
  id        String    @id @default(uuid())
  schoolId  String
  addressId String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  address   Address   @relation(fields: [addressId], references: [id])
  school    School    @relation(fields: [schoolId], references: [id])

  @@unique([schoolId, addressId])
  @@map("school_addresses")
}

/// *
/// * School
/// * ------
/// * The top-level entity representing a school or educational institution.
/// * All other entities (students, staff, sessions, etc.) are associated with a school.
/// * This model enables multi-school support within the same system.
model School {
  id                           String                        @id @default(uuid())
  name                         String
  code                         String                        @unique
  primaryAddressId             String?
  createdAt                    DateTime                      @default(now())
  updatedAt                    DateTime                      @updatedAt
  deletedAt                    DateTime?
  logoUrl                      String?
  email                        String?
  phone                        String?
  website                      String?
  accreditation                String?
  description                  String?
  establishedYear              String?
  motto                        String?
  principalEmail               String?
  principalName                String?
  schoolType                   String?
  studentCapacity              String?
  colorScheme                  String?
  resultTemplateId             String?                       @default("classic") @map("result_template_id")
  academicSessions             AcademicSession[]
  assessmentStructureTemplates AssessmentStructureTemplate[]
  bulkImportJobs               BulkImportJob[]
  categories                   Category[]
  classArms                    ClassArm[]
  complaints                   Complaint[]
  counters                     Counter[]
  departments                  Department[]
  gradingModel                 GradingModel?
  levelProgressions            LevelProgression[]
  levels                       Level[]
  paymentStructures            PaymentStructure[]
  addresses                    SchoolAddress[]
  primaryAddress               Address?                      @relation("SchoolPrimaryAddress", fields: [primaryAddressId], references: [id])
  subjects                     Subject[]
  userActivities               UserActivity[]
  users                        User[]
  academicPromotionSettings    AcademicPromotionSettings?

  @@map("schools")
}

/// *
/// * AcademicPromotionSettings
/// * -------------------------
/// * Stores academic promotion settings for each school, including core subjects,
/// * minimum requirements, and attendance criteria for student promotion.
model AcademicPromotionSettings {
  id                     String   @id @default(uuid())
  schoolId               String   @unique
  coreSubjects           String[] // Array of subject names that must be passed
  totalSubjectsPassed    Int      // Minimum number of subjects to pass
  totalAverage           Int      // Minimum overall average required
  useAttendance          Boolean  @default(true) // Whether to include attendance criteria
  minimumAttendanceRate  Int      // Minimum attendance rate (if attendance is enabled)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  school                 School   @relation(fields: [schoolId], references: [id])

  @@map("academic_promotion_settings")
}

/// *
/// * AcademicSession
/// * ----------------
/// * Represents a full academic year or session for a school (e.g., 2023/2024).
/// * Each session has a start and end date, and is associated with a specific school.
/// * Academic sessions are divided into terms (e.g., First Term, Second Term).
/// * This entity is central for grouping all academic activities, such as attendance, grading, and curriculum planning, within a specific school year.
/// * The isCurrent flag indicates if this is the active session for the school.
model AcademicSession {
  id                           String                        @id @default(uuid())
  academicYear                 String
  startDate                    DateTime
  endDate                      DateTime
  isCurrent                    Boolean                       @default(false)
  schoolId                     String
  createdAt                    DateTime                      @default(now())
  updatedAt                    DateTime                      @updatedAt
  deletedAt                    DateTime?
  calendar                     AcademicSessionCalendar?
  school                       School                        @relation(fields: [schoolId], references: [id])
  assessmentStructureTemplates AssessmentStructureTemplate[]
  classArmStudents             ClassArmStudent[]
  classArms                    ClassArm[]
  paymentStructures            PaymentStructure[]
  promotionsFrom               StudentPromotion[]            @relation("PromotionFromSession")
  promotionsTo                 StudentPromotion[]            @relation("PromotionToSession")
  terms                        Term[]

  @@map("academic_sessions")
}

/// *
/// * AcademicSessionCalendar
/// * -----------------------
/// * Stores the calendar for a specific academic session, including all important dates and events (e.g., holidays, exams, resumption dates).
/// * Each session has one calendar, and each calendar can have multiple items (events).
/// * This helps schools plan and communicate their yearly schedule to staff, students, and guardians.
model AcademicSessionCalendar {
  id                String                        @id @default(uuid())
  academicSessionId String                        @unique
  createdAt         DateTime                      @default(now())
  updatedAt         DateTime                      @updatedAt
  deletedAt         DateTime?
  items             AcademicSessionCalendarItem[]
  academicSession   AcademicSession               @relation(fields: [academicSessionId], references: [id])

  @@map("academic_session_calendars")
}

/// *
/// * AcademicSessionCalendarItem
/// * ---------------------------
/// * Represents a single event or item in the academic session calendar (e.g., "First Term Begins", "Midterm Break").
/// * Each item has a title, a start date, and optionally an end date.
/// * Used for scheduling and tracking key academic events throughout the session.
model AcademicSessionCalendarItem {
  id         String                  @id @default(uuid())
  calendarId String
  title      String
  startDate  DateTime
  endDate    DateTime?
  createdAt  DateTime                @default(now())
  updatedAt  DateTime                @updatedAt
  deletedAt  DateTime?
  calendar   AcademicSessionCalendar @relation(fields: [calendarId], references: [id])

  @@map("academic_session_calendar_items")
}

/// *
/// * Term
/// * ----
/// * Represents a term within an academic session (e.g., First Term, Second Term).
/// * Terms divide the academic session into manageable periods for teaching, assessment, and reporting.
/// * Each term is linked to an academic session and has its own set of subjects, attendance, and assessments.
model Term {
  id                 String              @id @default(uuid())
  name               String
  academicSessionId  String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  deletedAt          DateTime?
  isCurrent          Boolean             @default(false)
  endDate            DateTime
  startDate          DateTime
  paymentStructures  PaymentStructure[]
  assessments        ClassArmStudentAssessment[]
  studentAttendances StudentAttendance[]
  subjectAttendances SubjectAttendance[]
  academicSession    AcademicSession            @relation(fields: [academicSessionId], references: [id])

  @@map("terms")
}

/// *
/// * Level
/// * -----
/// * Represents a grade or year group in the school (e.g., SS1, JSS1, Grade 10).
/// * Levels organize students and class arms by age or academic progress.
/// * This entity is fundamental for structuring the school and managing student progression.
model Level {
  id                String             @id @default(uuid())
  name              String
  schoolId          String
  order             Int
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  deletedAt         DateTime?
  code              String             @unique
  classArms         ClassArm[]
  progressionsFrom  LevelProgression[] @relation("ProgressionFromLevel")
  progressionsTo    LevelProgression[] @relation("ProgressionToLevel")
  school            School             @relation(fields: [schoolId], references: [id])
  paymentStructures PaymentStructure[]
  promotionsFrom    StudentPromotion[] @relation("PromotionFromLevel")
  promotionsTo      StudentPromotion[] @relation("PromotionToLevel")

  @@map("levels")
}

/// *
/// * Department
/// * ----------
/// * Represents an academic department within a school (e.g., Science, Arts, Languages).
/// * Departments group related subjects and class arms, and are managed by a head of department (HOD).
/// * This structure supports subject specialization and departmental administration.
model Department {
  id        String     @id @default(uuid())
  name      String
  hodId     String?
  schoolId  String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  deletedAt DateTime?
  code      String     @unique
  classArms ClassArm[]
  school    School     @relation(fields: [schoolId], references: [id])
  hod       Hod?
  subjects  Subject[]
  teachers  Teacher[]

  @@index([schoolId])
  @@map("departments")
}

/// *
/// * ClassArm
/// * --------
/// * Represents a subdivision of a level or grade (e.g., "SS1A", "Grade 10B").
/// * Each class arm belongs to a level and a school, and may be associated with a department.
/// * Class arms group students for teaching, attendance, and administrative purposes.
/// * They are also linked to teachers and subjects for classroom management.
model ClassArm {
  id                      String                   @id @default(uuid())
  name                    String
  academicSessionId       String
  levelId                 String
  departmentId            String?
  schoolId                String
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  deletedAt               DateTime?
  captainId               String?                  @unique
  classTeacherId          String?
  location                String?
  slug                    String                   @unique
  classArmStudents        ClassArmStudent[]
  classArmSubjects        ClassArmSubject[]
  classArmTeachers        ClassArmTeacher[]
  academicSession         AcademicSession          @relation(fields: [academicSessionId], references: [id])
  captain                 Student?                 @relation("ClassArmCaptain", fields: [captainId], references: [id])
  classTeacher            Teacher?                 @relation("ClassArmTeacher", fields: [classTeacherId], references: [id])
  department              Department?              @relation(fields: [departmentId], references: [id])
  level                   Level                    @relation(fields: [levelId], references: [id])
  school                  School                   @relation(fields: [schoolId], references: [id])
  paymentStructures       PaymentStructure[]
  promotionsFrom          StudentPromotion[]       @relation("PromotionFromClassArm")
  promotionsTo            StudentPromotion[]       @relation("PromotionToClassArm")

  @@unique([name, levelId, academicSessionId, schoolId], name: "unique_class_arm_per_level_session")
  @@map("class_arms")
}

/// *
/// * User
/// * ----
/// * Represents a user account in the system, which can be a student, teacher, admin, or guardian.
/// * Stores authentication and profile information, and links to the specific role entity (student, teacher, etc.).
/// * This model is central for access control, personalization, and communication.
model User {
  id                  String               @id @default(uuid())
  type                UserType
  email               String?
  phone               String?
  password            String
  phoneVerified       Boolean              @default(false)
  emailVerified       Boolean              @default(false)
  firstName           String
  lastName            String
  addressId           String?
  avatarUrl           String?
  dateOfBirth         DateTime?
  schoolId            String?
  mustUpdatePassword  Boolean              @default(false)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  deletedAt           DateTime?
  gender              Gender
  stateOfOrigin       String?
  lastLoginAt         DateTime?
  admin               Admin?
  bulkImportJobs      BulkImportJob[]
  colorSchemePayments ColorSchemePayment[]
  complaintComments   ComplaintComment[]   @relation("ComplaintCommentAuthor")
  complaintsReported  Complaint[]          @relation("ComplaintReporter")
  guardian            Guardian?
  student             Student?
  systemAdmin         SystemAdmin?
  teacher             Teacher?
  activities          UserActivity[]
  preferences         UserPreferences?
  tokens              UserToken[]
  address             Address?             @relation(fields: [addressId], references: [id])
  school              School?              @relation(fields: [schoolId], references: [id])

  @@map("users")
}

/// *
/// * UserToken
/// * ---------
/// * Represents a token used for user authentication and authorization (e.g., refresh tokens, password reset tokens).
/// * Supports secure login, session management, and account recovery.
model UserToken {
  id          String        @id @default(uuid())
  type        UserTokenType
  token       String
  userId      String
  expires     DateTime
  blacklisted Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  deletedAt   DateTime?
  user        User          @relation(fields: [userId], references: [id])

  @@unique([userId, type])
  @@index([type])
  @@map("user_tokens")
}

/// *
/// * Admin
/// * -----
/// * Represents a system administrator for a school.
/// * Admins have elevated privileges to manage users, configure school settings, and oversee operations.
/// * Each admin is linked to a user account and can be marked as a super admin for higher-level access.
/// * This entity is crucial for access control and school management.
model Admin {
  id        String    @id @default(uuid())
  userId    String    @unique
  adminNo   String    @unique
  isSuper   Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  user      User      @relation(fields: [userId], references: [id])

  @@map("admins")
}

/// *
/// * SystemAdmin
/// * -----------
/// * Represents an internal system administrator for the platform.
/// * System admins are our own internal staff who control the backend platform,
/// * manage school signup requests, and oversee the entire system.
/// * This is different from school admins who manage individual schools.
model SystemAdmin {
  id                 String                @id @default(uuid())
  userId             String                @unique
  role               String
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  deletedAt          DateTime?
  assignedComplaints Complaint[]           @relation("ComplaintAssignee")
  signupRequests     SchoolSignupRequest[]
  user               User                  @relation(fields: [userId], references: [id])

  @@map("system_admins")
}

/// *
/// * Teacher
/// * -------
/// * Represents a teacher employed by the school.
/// * Stores personal and professional information, and links teachers to the subjects and class arms they teach.
/// * Teachers may also have administrative roles (e.g., HOD, class teacher).
model Teacher {
  id                      String                   @id @default(uuid())
  userId                  String                   @unique
  teacherNo               String                   @unique
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  deletedAt               DateTime?
  employmentType          EmploymentType           @default(FULL_TIME)
  joinDate                DateTime                 @default(now())
  qualification           String?
  status                  TeacherStatus            @default(ACTIVE)
  departmentId            String?
  classArmSubjectTeachers ClassArmSubjectTeacher[]
  classArmTeachers        ClassArmTeacher[]
  classArmsAsTeacher      ClassArm[]               @relation("ClassArmTeacher")
  hod                     Hod?
  department              Department?              @relation(fields: [departmentId], references: [id])
  user                    User                     @relation(fields: [userId], references: [id])

  @@map("teachers")
}

/// *
/// * Guardian
/// * --------
/// * Represents a parent or guardian responsible for one or more students.
/// * Guardians can access student information, receive notifications, and communicate with the school.
/// * This entity is key for parent engagement and student support.
model Guardian {
  id        String    @id @default(uuid())
  userId    String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  user      User      @relation(fields: [userId], references: [id])
  students  Student[]

  @@map("guardians")
}

/// *
/// * Student
/// * -------
/// * Represents a student enrolled in the school.
/// * Stores personal, academic, and administrative information about each student.
/// * Students are linked to class arms, guardians, and have records for attendance, assessments, and curriculum progress.
model Student {
  id                    String                 @id @default(uuid())
  userId                String                 @unique
  studentNo             String                 @unique
  admissionDate         DateTime
  admissionNo           String?                @unique
  guardianId            String?
  guardianFirstName     String?
  guardianLastName      String?
  guardianEmail         String?
  guardianPhone         String?
  address               Json?
  medicalInformation    Json?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  deletedAt             DateTime?
  status                StudentStatus          @default(ACTIVE)
  assessments           ClassArmStudentAssessment[]
  classArmStudents      ClassArmStudent[]
  classArmAsCaptain     ClassArm?                   @relation("ClassArmCaptain")
  prefect               Prefect?
  studentPayments       StudentPayment[]
  promotedFrom          StudentPromotion[]          @relation("PromotedStudent")
  promotions            StudentPromotion[]
  statusHistory         StudentStatusHistory[]
  guardian              Guardian?                   @relation(fields: [guardianId], references: [id])
  user                  User                        @relation(fields: [userId], references: [id])

  @@map("students")
}

/// *
/// * ClassArmStudent
/// * ---------------
/// * Represents the relationship between a student and a class arm for a specific academic session.
/// * This creates a many-to-many relationship that preserves the complete history of a student's
/// * journey through different class arms and sessions. When a student is promoted, a new
/// * ClassArmStudent record is created for the new class arm, while the old records remain
/// * for historical purposes. This allows the system to maintain complete records when
/// * switching between different academic sessions and terms.
model ClassArmStudent {
  id                 String              @id @default(uuid())
  studentId          String
  classArmId         String
  academicSessionId  String
  isActive           Boolean             @default(true)
  enrolledAt         DateTime            @default(now())
  leftAt             DateTime?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  deletedAt          DateTime?
  academicSession    AcademicSession     @relation(fields: [academicSessionId], references: [id], onDelete: Cascade)
  classArm            ClassArm             @relation(fields: [classArmId], references: [id], onDelete: Cascade)
  student             Student              @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentAttendances  StudentAttendance[]
  subjectAttendances  SubjectAttendance[]

  @@unique([studentId, classArmId, academicSessionId])
  @@index([studentId])
  @@index([classArmId])
  @@index([academicSessionId])
  @@index([isActive])
  @@map("class_arm_students")
}

/// *
/// * StudentStatusHistory
/// * --------------------
/// * Tracks the history of student status changes for audit purposes.
/// * Each record represents a status transition with metadata about the change.
model StudentStatusHistory {
  id             String        @id @default(uuid())
  studentId      String
  previousStatus StudentStatus
  newStatus      StudentStatus
  reason         String?
  effectiveDate  DateTime
  notes          String?
  changedBy      String
  changedAt      DateTime      @default(now())
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  student        Student       @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([changedAt])
  @@map("student_status_history")
}

/// *
/// * Subject
/// * -------
/// * Represents a subject offered by the school (e.g., Mathematics, English Language).
/// * Subjects are linked to departments and schools, and are taught by teachers to students in various class arms.
/// * This entity is central to curriculum planning and academic reporting.
model Subject {
  id                      String                   @id @default(uuid())
  name                    String
  schoolId                String
  departmentId            String?
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  deletedAt               DateTime?
  categoryId              String?
  classArmSubjects        ClassArmSubject[]
  subjectAttendances      SubjectAttendance[]
  category                Category?         @relation(fields: [categoryId], references: [id])
  department              Department?       @relation(fields: [departmentId], references: [id])
  school                  School            @relation(fields: [schoolId], references: [id])

  @@map("subjects")
}

/// *
/// * ClassArmSubject
/// * ---------------
/// * Represents the assignment of a subject to a class arm.
/// * This is a first-class entity that exists independently of teacher assignments.
/// * A class arm can take a subject even without a teacher assigned.
model ClassArmSubject {
  id          String                      @id @default(uuid())
  classArmId  String
  subjectId   String
  createdAt   DateTime                    @default(now())
  updatedAt   DateTime                    @updatedAt
  deletedAt   DateTime?
  classArm    ClassArm                    @relation(fields: [classArmId], references: [id])
  subject     Subject                     @relation(fields: [subjectId], references: [id])
  teachers    ClassArmSubjectTeacher[]
  assessments ClassArmStudentAssessment[]

  @@unique([classArmId, subjectId])
  @@map("class_arm_subjects")
}

/// *
/// * AssessmentStructure
/// * -------------------
/// * Defines the standard assessment structure for a school (e.g., Test 1 (20%), Test 2 (20%), Exam (60%)).
/// * Each school can customize their assessment structure, but it must total 100%.
/// * This provides consistency across all subjects and students in the school.
/// *
/// * AssessmentStructureTemplate
/// * -------------------------
/// * Represents a complete assessment structure for a school and academic session.
/// * Contains all assessment types (tests, exams, etc.) as embedded data.
/// * Only one active template per school per session.
model AssessmentStructureTemplate {
  id                String           @id @default(uuid())
  schoolId          String?
  academicSessionId String?
  name              String
  description       String?
  assessments       Json
  isActive          Boolean          @default(true)
  isGlobalDefault   Boolean          @default(false)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  deletedAt         DateTime?
  academicSession   AcademicSession? @relation(fields: [academicSessionId], references: [id])
  school            School?          @relation(fields: [schoolId], references: [id])

  @@unique([schoolId, academicSessionId, isActive], name: "unique_active_template_per_session")
  @@index([academicSessionId])
  @@index([isGlobalDefault])
  @@map("assessment_structure_templates")
}


/// *
/// * ClassArmStudentAssessment
/// * -------------------------
/// * Represents an individual assessment score for a student in a class arm subject.
/// * Links directly to ClassArmSubject, Student, and Term — no intermediary tables.
/// * assessmentTypeId links to the UUID of the assessment entry in AssessmentStructureTemplate.assessments JSON.
/// * maxScore is snapshotted at the time of scoring so historical data stays accurate.
model ClassArmStudentAssessment {
  id                String          @id @default(uuid())
  classArmSubjectId String
  studentId         String
  termId            String
  name              String
  score             Int
  isExam            Boolean         @default(false)
  assessmentTypeId  String?
  maxScore          Int?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?
  classArmSubject   ClassArmSubject @relation(fields: [classArmSubjectId], references: [id])
  student           Student         @relation(fields: [studentId], references: [id])
  term              Term            @relation(fields: [termId], references: [id])

  @@unique([classArmSubjectId, studentId, termId, name])
  @@index([studentId])
  @@index([classArmSubjectId])
  @@index([termId])
  @@map("class_arm_student_assessments")
}

/// *
/// * GradingModel
/// * ------------
/// * Defines the grading system for a school (e.g., what score ranges correspond to grades A, B, C, etc.).
/// * Each school can have its own grading model, which is used to interpret student scores and generate report cards.
/// * GradingModel model example
/// * {
/// * "A": [70, 100],
/// * "B": [60, 69],
/// * “C”: [
/// * ...
/// * }
model GradingModel {
  id        String    @id @default(uuid())
  schoolId  String    @unique
  model     Json
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  school    School    @relation(fields: [schoolId], references: [id])

  @@map("grading_models")
}

/// *
/// * StudentAttendance
/// * -----------------
/// * Tracks a student's attendance for each day, including their status (present, absent, late, excused).
/// * Attendance is linked to the student, class arm, academic session, and term.
/// * This data is vital for monitoring student engagement and compliance.
model StudentAttendance {
  id                   String           @id @default(uuid())
  date                 DateTime
  status               AttendanceStatus
  termId               String
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  deletedAt            DateTime?
  classArmStudentId    String
  class_arm_student_id String?          @db.Uuid
  classArmStudent      ClassArmStudent  @relation(fields: [classArmStudentId], references: [id], onDelete: Cascade)
  term                 Term             @relation(fields: [termId], references: [id])

  @@unique([classArmStudentId, date])
  @@unique([class_arm_student_id, date])
  @@map("student_attendances")
}

/// *
/// * SubjectAttendance
/// * -----------------
/// * Tracks a student's attendance for a specific subject on each day.
/// * Separated from StudentAttendance (class attendance) to allow independent tracking.
/// * Multiple subject attendances can exist per student per day (one per subject).
model SubjectAttendance {
  id                String           @id @default(uuid())
  date              DateTime
  status            AttendanceStatus
  subjectId         String
  termId            String
  classArmStudentId String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  deletedAt         DateTime?

  classArmStudent   ClassArmStudent  @relation(fields: [classArmStudentId], references: [id], onDelete: Cascade)
  term              Term             @relation(fields: [termId], references: [id])
  subject           Subject          @relation(fields: [subjectId], references: [id])

  @@unique([classArmStudentId, date, subjectId])
  @@map("subject_attendances")
}

/// *
/// * ClassArmTeacher
/// * ---------------
/// * Associates a teacher with a class arm, indicating the teacher's responsibility for that class arm (e.g., class teacher or homeroom teacher).
/// * This is used for administrative and pastoral care purposes.
model ClassArmTeacher {
  id         String    @id @default(uuid())
  teacherId  String
  classArmId String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  deletedAt  DateTime?
  classArm   ClassArm  @relation(fields: [classArmId], references: [id])
  teacher    Teacher   @relation(fields: [teacherId], references: [id])

  @@map("class_arm_teachers")
}

/// *
/// * ClassArmSubjectTeacher
/// * ----------------------
/// * Associates a teacher with a ClassArmSubject, indicating which teacher teaches a specific subject in a specific class arm.
/// * References ClassArmSubject instead of separate classArmId + subjectId.
/// * e.g JSS2A maths teacher is Mr. John Doe
model ClassArmSubjectTeacher {
  id                String          @id @default(uuid())
  classArmSubjectId String
  teacherId         String
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?
  classArmSubject   ClassArmSubject @relation(fields: [classArmSubjectId], references: [id])
  teacher           Teacher         @relation(fields: [teacherId], references: [id])

  @@unique([classArmSubjectId, teacherId])
  @@map("class_arm_subject_teachers")
}

/// *
/// * Hod (Head of Department)
/// * ------------------------
/// * Associates a teacher as the head of a department, giving them administrative responsibilities over that department.
/// * HODs oversee subject delivery, curriculum planning, and departmental staff.
/// * teachers can appear as HODs in multiple departments or the same department for different tenures.
/// * entry is created when a teacher is assigned as HOD for a department.
/// * and we set the hodId for the department.
/// * and the end date is set when the teacher is no longer the HOD of the department.
/// * e.g Mr. John Doe is the HOD of the Science Department
model Hod {
  id           String     @id @default(uuid())
  teacherId    String     @unique
  departmentId String     @unique
  startDate    DateTime   @default(now())
  endDate      DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  deletedAt    DateTime?
  department   Department @relation(fields: [departmentId], references: [id])
  teacher      Teacher    @relation(fields: [teacherId], references: [id])

  @@map("hods")
}

/// *
/// * Prefect
/// * -------
/// * Represents a student who has been given a leadership role (e.g., class captain, head boy/girl).
/// * Prefects assist with school discipline, represent the student body, and help organize events.
model Prefect {
  id        String    @id @default(uuid())
  studentId String    @unique
  role      String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  student   Student   @relation(fields: [studentId], references: [id])

  @@map("prefects")
}

/// *
/// * Counter
/// * -------
/// * Used to generate and track unique numbers for various entities within a school (e.g., student numbers, teacher numbers).
/// * Ensures that each entity (like a student or teacher) has a unique, sequential identifier within the school.
model Counter {
  id        String    @id @default(uuid())
  schoolId  String
  entity    String
  current   Int       @default(0)
  updatedAt DateTime  @updatedAt
  createdAt DateTime  @default(now())
  deletedAt DateTime?
  school    School    @relation(fields: [schoolId], references: [id])

  @@unique([schoolId, entity])
  @@map("counters")
}

/// *
/// * GlobalCounter
/// * -------------
/// * Used to generate and track unique numbers for platform-level entities (e.g., school codes).
/// * Unlike Counter which is scoped to a school, this is for global/platform-wide sequences.
model GlobalCounter {
  id        String    @id @default(uuid())
  entity    String    @unique
  current   Int       @default(0)
  updatedAt DateTime  @updatedAt
  createdAt DateTime  @default(now())

  @@map("global_counters")
}

/// *
/// * SchoolSignupRequest
/// * -------------------
/// * Represents a school's signup request for platform access.
/// * Stores all the information submitted by schools during the signup process.
/// * System admins review and approve/reject these requests.
model SchoolSignupRequest {
  id              String             @id @default(uuid())
  schoolName      String
  schoolCode      String?            @unique
  contactPerson   Json
  address         Json
  schoolDetails   Json
  status          SchoolSignupStatus @default(PENDING)
  submittedAt     DateTime           @default(now())
  reviewedAt      DateTime?
  reviewerId      String?
  notes           String?
  rejectionReason String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  reviewer        SystemAdmin?       @relation(fields: [reviewerId], references: [id])

  @@map("school_signup_requests")
}

/// *
/// * PaymentStructure
/// * ----------------
/// * Defines payment structures that can be applied to different categories of students.
/// * Each payment structure has a specific amount, frequency, and can be applied to
/// * academic sessions, terms, levels, class arms, or individual students.
model PaymentStructure {
  id                String           @id @default(uuid())
  name              String
  description       String?
  amount            Decimal          @db.Decimal(10, 2)
  currency          String           @default("NGN")
  category          PaymentCategory
  frequency         PaymentFrequency
  schoolId          String
  academicSessionId String?
  termId            String?
  levelId           String?
  classArmId        String?
  dueDate           DateTime?
  isActive          Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  deletedAt         DateTime?
  academicSession   AcademicSession? @relation(fields: [academicSessionId], references: [id])
  classArm          ClassArm?        @relation(fields: [classArmId], references: [id])
  level             Level?           @relation(fields: [levelId], references: [id])
  school            School           @relation(fields: [schoolId], references: [id])
  term              Term?            @relation(fields: [termId], references: [id])
  studentPayments   StudentPayment[]

  @@index([schoolId])
  @@index([academicSessionId])
  @@index([termId])
  @@index([levelId])
  @@index([classArmId])
  @@map("payment_structures")
}

/// *
/// * StudentPayment
/// * --------------
/// * Links payment structures to individual students, creating specific payment obligations.
/// * This allows for tracking individual student payment status and history.
model StudentPayment {
  id                 String           @id @default(uuid())
  studentId          String
  paymentStructureId String
  amount             Decimal          @db.Decimal(10, 2)
  currency           String           @default("NGN")
  status             PaymentStatus    @default(PENDING)
  dueDate            DateTime
  paidAmount         Decimal          @default(0) @db.Decimal(10, 2)
  paidAt             DateTime?
  notes              String?
  waivedBy           String?
  waivedAt           DateTime?
  waiverReason       String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  deletedAt          DateTime?
  paymentStructure   PaymentStructure @relation(fields: [paymentStructureId], references: [id])
  student            Student          @relation(fields: [studentId], references: [id])

  @@index([studentId])
  @@index([paymentStructureId])
  @@index([dueDate])
  @@map("student_payments")
}

/// *
/// * UserActivity
/// * ------------
/// * Tracks all user activities and actions within the system for audit and monitoring purposes.
/// * Provides comprehensive audit trail for security, compliance, and analytics.
/// * Each activity is linked to a user and school, with detailed information about the action performed.
model UserActivity {
  id          String   @id @default(uuid())
  userId      String
  schoolId    String
  action      String
  entityType  String
  entityId    String?
  details     Json?
  description String?
  ipAddress   String?
  userAgent   String?
  requestId   String?
  severity    String   @default("INFO")
  category    String?
  timestamp   DateTime @default(now())
  createdAt   DateTime @default(now())
  school      School   @relation(fields: [schoolId], references: [id])
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([schoolId])
  @@index([action])
  @@index([entityType])
  @@index([timestamp])
  @@index([severity])
  @@index([category])
  @@map("user_activities")
}

/// *
/// * UserPreferences
/// * ----------------
/// * Stores user preferences for theme, color scheme, and notification settings.
/// * Allows users to customize their experience while maintaining school branding.
model UserPreferences {
  id                 String          @id @default(uuid())
  userId             String          @unique
  themeMode          ThemeMode       @default(SYSTEM)
  colorSchemeType    ColorSchemeType @default(SCHOOL)
  emailNotifications Boolean         @default(true)
  smsNotifications   Boolean         @default(false)
  pushNotifications  Boolean         @default(true)
  inAppNotifications Boolean         @default(true)
  marketingEmails    Boolean         @default(false)
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  schoolColorScheme  String?         @default("default")
  customColorScheme  String?         @default("default")
  user               User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

/// *
/// * ColorSchemePayment
/// * ------------------
/// * Tracks payments for custom color scheme access.
/// * Users must pay a fee to use custom colors instead of school colors.
model ColorSchemePayment {
  id               String        @id @default(uuid())
  userId           String
  amount           Decimal       @db.Decimal(10, 2)
  currency         String        @default("NGN")
  status           PaymentStatus @default(PENDING)
  paymentReference String?
  paymentProvider  String?
  paidAt           DateTime?
  expiresAt        DateTime?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  authorizationUrl String?
  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@map("color_scheme_payments")
}

model BulkImportJob {
  id                String            @id @default(cuid())
  schoolId          String
  userId            String
  fileName          String
  fileSize          Int
  totalRecords      Int
  processedRecords  Int               @default(0)
  successfulRecords Int               @default(0)
  failedRecords     Int               @default(0)
  status            BulkImportStatus  @default(PENDING)
  options           Json?
  errors            Json              @default("[]")
  startedAt         DateTime?
  completedAt       DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  importErrors      BulkImportError[]
  school            School            @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([schoolId])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("bulk_import_jobs")
}

model BulkImportError {
  id           String        @id @default(cuid())
  jobId        String
  rowNumber    Int
  fieldName    String?
  errorMessage String
  fieldValue   String?
  createdAt    DateTime      @default(now())
  job          BulkImportJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([rowNumber])
  @@map("bulk_import_errors")
}

/// *
/// * Category
/// * -------
/// * Represents a subject category that can be created and managed by schools.
/// * Categories are used to classify subjects (e.g., Core, Elective, Vocational).
/// * Each school can have its own set of categories, with default ones seeded during school creation.
model Category {
  id          String    @id @default(uuid())
  name        String
  description String?
  schoolId    String
  isDefault   Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  school      School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  subjects    Subject[]

  @@unique([schoolId, name])
  @@map("categories")
}

/// *
/// * Complaint
/// * ---------
/// * Represents a complaint or issue reported by users or schools.
/// * System admins can track, assign, and resolve complaints.
model Complaint {
  id           String                @id @default(uuid())
  title        String
  description  String
  category     ComplaintCategory
  priority     ComplaintPriority     @default(MEDIUM)
  status       ComplaintStatus       @default(OPEN)
  reporterId   String?
  schoolId     String?
  assignedToId String?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  resolvedAt   DateTime?
  closedAt     DateTime?
  attachments  ComplaintAttachment[]
  comments     ComplaintComment[]
  assignedTo   SystemAdmin?          @relation("ComplaintAssignee", fields: [assignedToId], references: [id])
  reporter     User?                 @relation("ComplaintReporter", fields: [reporterId], references: [id])
  school       School?               @relation(fields: [schoolId], references: [id])

  @@index([status])
  @@index([priority])
  @@index([category])
  @@index([assignedToId])
  @@map("complaints")
}

/// *
/// * ComplaintAttachment
/// * -------------------
/// * Stores file attachments for complaints.
model ComplaintAttachment {
  id          String    @id @default(uuid())
  complaintId String
  fileName    String
  fileUrl     String
  fileSize    Int
  mimeType    String
  createdAt   DateTime  @default(now())
  complaint   Complaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)

  @@map("complaint_attachments")
}

/// *
/// * ComplaintComment
/// * ----------------
/// * Stores comments and updates on complaints.
model ComplaintComment {
  id          String    @id @default(uuid())
  complaintId String
  authorId    String
  content     String
  isInternal  Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  author      User      @relation("ComplaintCommentAuthor", fields: [authorId], references: [id])
  complaint   Complaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)

  @@map("complaint_comments")
}

/// *
/// * StudentPromotion
/// * ----------------
/// * Tracks student promotions between academic sessions and levels.
/// * Maintains complete history of student academic progression.
model StudentPromotion {
  id                    String           @id @default(uuid())
  studentId             String
  fromClassArmId        String?
  toClassArmId          String
  fromLevelId           String?
  toLevelId             String
  fromAcademicSessionId String?
  toAcademicSessionId   String
  promotionType         PromotionType
  promotionDate         DateTime
  promotedBy            String
  notes                 String?
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  deletedAt             DateTime?
  promotedStudentId     String?
  fromAcademicSession   AcademicSession? @relation("PromotionFromSession", fields: [fromAcademicSessionId], references: [id])
  fromClassArm          ClassArm?        @relation("PromotionFromClassArm", fields: [fromClassArmId], references: [id])
  fromLevel             Level?           @relation("PromotionFromLevel", fields: [fromLevelId], references: [id])
  promotedStudent       Student?         @relation("PromotedStudent", fields: [promotedStudentId], references: [id], onDelete: Cascade)
  student               Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)
  toAcademicSession     AcademicSession  @relation("PromotionToSession", fields: [toAcademicSessionId], references: [id])
  toClassArm            ClassArm         @relation("PromotionToClassArm", fields: [toClassArmId], references: [id])
  toLevel               Level            @relation("PromotionToLevel", fields: [toLevelId], references: [id])

  @@index([studentId])
  @@index([promotedStudentId])
  @@index([promotionDate])
  @@map("student_promotions")
}

/// *
/// * LevelProgression
/// * ----------------
/// * Defines the progression rules between academic levels.
/// * Configurable per school to support different academic structures.
model LevelProgression {
  id               String    @id @default(uuid())
  schoolId         String
  fromLevelId      String
  toLevelId        String
  isAutomatic      Boolean   @default(true)
  requiresApproval Boolean   @default(false)
  order            Int       @default(0)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  deletedAt        DateTime?
  fromLevel        Level     @relation("ProgressionFromLevel", fields: [fromLevelId], references: [id], onDelete: Cascade)
  school           School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  toLevel          Level     @relation("ProgressionToLevel", fields: [toLevelId], references: [id], onDelete: Cascade)

  @@index([schoolId])
  @@map("level_progressions")
}


enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum UserType {
  SUPER_ADMIN
  ADMIN
  GUARDIAN
  STUDENT
  TEACHER
  SYSTEM_ADMIN
}

enum UserTokenType {
  RESET_PASSWORD
  REFRESH_TOKEN
}

enum SchoolSignupStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
}

enum SchoolType {
  PRIMARY
  SECONDARY
  MIXED
}

enum Gender {
  MALE
  FEMALE
}

enum TeacherStatus {
  ACTIVE
  INACTIVE
  ON_LEAVE
}

enum ColorSchemeType {
  SCHOOL
  CUSTOM
}

enum ThemeMode {
  LIGHT
  DARK
  SYSTEM
}

enum NotificationType {
  EMAIL
  SMS
  PUSH
  IN_APP
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
}

enum SubjectCategory {
  CORE
  GENERAL
  VOCATIONAL
}

enum PaymentFrequency {
  ONCE_PER_SESSION
  ONCE_PER_TERM
  MONTHLY
  WEEKLY
  CUSTOM
}

enum PaymentStatus {
  PENDING
  PAID
  OVERDUE
  PARTIAL
  WAIVED
  EXPIRED
}

enum PaymentCategory {
  TUITION
  EXAMINATION
  LIBRARY
  LABORATORY
  SPORTS
  TRANSPORT
  UNIFORM
  TEXTBOOK
  EXCURSION
  OTHER
}

enum StudentStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  GRADUATED
  TRANSFERRED
}

enum BulkImportStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum ComplaintCategory {
  TECHNICAL
  BILLING
  FEATURE_REQUEST
  BUG_REPORT
  ACCOUNT_ISSUE
  PERFORMANCE
  SECURITY
  OTHER
}

enum ComplaintPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ComplaintStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
  CANCELLED
}

enum PromotionType {
  AUTOMATIC
  MANUAL
  REPEAT
  GRADUATION
  TRANSFER
}
